# Change prefix from Ctrl+b to Ctrl+a (optional, commented out)
# unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Enable mouse support
set -g mouse on

# Enable extended keys (for Shift+Enter, Ctrl+Enter, etc.)
set -s extended-keys always
set -as terminal-features 'xterm*:extkeys'

# Manual Shift+Enter binding (workaround for Ghostty)
bind-key -T root S-Enter send-keys Escape "[13;2u"

# Improve colors
set -g default-terminal "tmux-256color"

# Better mouse passthrough to applications like vim
set -ga terminal-overrides ',*:smcup@:rmcup@'

# Set scrollback buffer to 10000
set -g history-limit 10000

# Start window numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Customize the status line
set -g status-fg white
set -g status-bg black
set -g status-interval 1

# Window status format - color logic:
#
#   1. Silent (~) + name ends with "d" → dark gray (colour240) - dismissed/done
#   2. Silent (~)                      → white                 - finished
#   3. Activity (#)                    → magenta/purple        - working
#   4. Default (no flags)              → yellow                - idle
#
setw -g window-status-format '#{?#{m:*~*,#F},#{?#{m:*d,#W},#[fg=colour240]#[bg=black],#[fg=white]#[bg=black]},#{?#{m:*##*,#F},#[fg=magenta]#[bg=black],#[fg=yellow]#[bg=black]}} #I:#W#F #[default]'
setw -g window-status-current-format ' #I:#W#F '

# Colors for ACTIVE/CURRENT window (the one you're on)
setw -g window-status-current-style fg=black,bg=green,bold

# Colors for windows with ACTIVITY (actively running/working)
setw -g window-status-activity-style fg=magenta,bg=black

# Colors for windows with no activity (idle)
setw -g window-status-style fg=yellow,bg=black

# Bell/alert colors
setw -g window-status-bell-style fg=yellow,bg=black
setw -g monitor-bell on
set -g visual-bell off

# Enable activity alerts (notify when there's activity)
# Disabled by default - uncomment if you want to see all activity
setw -g monitor-activity on
set -g visual-activity off

# Monitor silence - notify when window goes quiet after 15s
setw -g monitor-silence 15
set -g visual-silence off


# Toggle monitoring silence for current window
# When enabled, tab will be PURPLE while working, then YELLOW when finished
bind m setw monitor-silence 30 \; display "Watching for completion (15s silence)"
bind M setw monitor-silence 0 \; display "Silence monitoring OFF"

# Use vim keybindings in copy mode
setw -g mode-keys vi

# Enable OSC 52 clipboard (allows remote tmux to copy to local clipboard)
set -g set-clipboard on

# Allow passthrough of escape sequences (needed for nested tmux over SSH)
set -g allow-passthrough on

# Copy to macOS clipboard (local copies)
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# Easier and faster switching between next/prev window
bind C-p previous-window
bind C-n next-window
bind-key -n C-S-Left previous-window
bind-key -n C-S-Right next-window
bind-key -n C-S-M-Left swap-window -t -1\; select-window -t -1
bind-key -n C-S-M-Right swap-window -t +1\; select-window -t +1
bind-key -n M-S-Left select-pane -L
bind-key -n M-S-Right select-pane -R
bind-key -n M-S-Up select-pane -U
bind-key -n M-S-Down select-pane -D

# Easier pane navigation with vim-like keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Split panes using | and - (preserve current path)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Default bindings with path preservation
bind c new-window -c "#{pane_current_path}"
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# Detach current window to a new session in a new Ghostty window
bind D run-shell "~/dotfiles/tmux-detach-window.sh"

# Reload config file easily
bind r source-file ~/.tmux.conf \; display "Config reloaded!"
